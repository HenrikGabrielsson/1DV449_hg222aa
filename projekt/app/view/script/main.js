var main={init:function(){if(document.getElementById("forFriendForm")!==null){main.submitFriendFormOnSelect()}if(document.getElementsByClassName("forMeFormText")[0]!==undefined){main.submitMeFormOnTextClick()}if(document.getElementById("suggestions")!==null){main.getSuggestionsForUser()}},refreshWhenOnline:function(){var e=setInterval(function(){main.pingServer(function(t){if(t){clearInterval(e);location.reload()}})},1e4)},getSuggestionsForUser:function(){var e=document.URL.split("id=")[1].split("&")[0];main.printLoadingScreen();if(window.localStorage){main.pingServer(function(t){if(t){main.getSuggestionsFromServer(e)}else{if(localStorage.getItem(e)){main.printCacheWarning(e);main.printSuggestions(e)}else{main.printError()}}})}else{main.getSuggestionsFromServer(e)}},printError:function(){var e=document.getElementById("suggestions");main.removeLoadingGif();var t=document.createElement("h2");var n=document.createElement("p");t.appendChild(document.createTextNode("Sorry!"));n.appendChild(document.createTextNode("Something went wrong when getting suggestions for you. Try again later!"));e.appendChild(t);e.appendChild(n)},printNoMerchandise:function(){var e=document.getElementById("suggestions");var t=document.createElement("p");t.appendChild(document.createTextNode("No merchandise found. Try to refresh the page, or buy more games..."));e.appendChild(t)},printCacheWarning:function(e){var t=document.getElementById("suggestions");var n=JSON.parse(window.localStorage.getItem(e)).timeReceived;var r=document.createElement("p");r.appendChild(document.createTextNode("Note that these suggestions are received from the cache, because of some unknown problem! Try to refresh at a later time. These products were received from Ebay at: "+new Date(new Date(JSON.parse(window.localStorage.getItem(e)).timeReceived))));t.appendChild(r)},printLoadingScreen:function(){document.getElementById("suggestions").setAttribute("class","loadingGif")},removeLoadingGif:function(){document.getElementById("suggestions").removeAttribute("class")},pingServer:function(e){$.ajax({url:"ajaxHelper.php?function=ping",timeout:1e4,cache:false,success:function(){e(true)},error:function(){e(false)},fail:function(){e(false)}})},printSuggestions:function(e){var t=JSON.parse(window.localStorage.getItem(e)).merchandise;var n=document.getElementById("suggestions");main.removeLoadingGif();var r=document.createElement("ul");n.appendChild(r);if(t.length===0){main.printNoMerchandise()}else{t.forEach(function(e){r.appendChild(main.createListElement(e))})}},createListElement:function(e){var t=document.createElement("li");var n=document.createElement("div");var r=document.createElement("div");var i=document.createElement("h2");var s=document.createElement("a");var o=document.createElement("img");var u=document.createElement("p");var a=document.createElement("p");var f=document.createElement("p");var l=document.createElement("p");var c=document.createElement("p");n.setAttribute("class","itemDisplay");r.setAttribute("class","item_about");s.appendChild(document.createTextNode(e.title));s.setAttribute("href",e.ebayURL);o.setAttribute("src",e.imageURL);u.appendChild(document.createTextNode("Game: "+e.gameTitle));u.setAttribute("class","gameTitle");a.appendChild(document.createTextNode("Location: "+e.location));f.appendChild(document.createTextNode("Country: "+e.country));l.appendChild(document.createTextNode("Auction started at: "+e.startTime.date));c.appendChild(document.createTextNode("Auction ends at: "+e.endTime.date));i.appendChild(s);n.appendChild(i);n.appendChild(r);r.appendChild(u);r.appendChild(a);r.appendChild(f);r.appendChild(l);r.appendChild(c);n.appendChild(o);t.appendChild(n);return t},getSuggestionsFromServer:function(e){var t=document.getElementById("token").innerHTML;$.get("ajaxHelper.php?function=getMerchandise&token="+t+"&id="+e,function(t){console.log(t);localStorage.setItem(e,t);main.printSuggestions(e)})},submitMeFormOnTextClick:function(){var e=document.getElementsByClassName("forMeFormText")[0];var t=document.getElementById("forMeForm");e.addEventListener("click",function(){t.submit()},false)},submitFriendFormOnSelect:function(){var e=document.getElementById("forFriendForm");e.addEventListener("change",function(){e.submit()},false)}};window.addEventListener("load",main.init,false)